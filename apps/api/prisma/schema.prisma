generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  EMPLOYEE
  MANAGER
  HR
  ADMIN
}

enum EmploymentStatus {
  ACTIVE
  INACTIVE
  TERMINATED
  ON_LEAVE
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String
  role          Role
  lastLoginAt   DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  employee      Employee?
  managedDepartments Department[] @relation("DepartmentManager")
  managedEmployees   Employee[]   @relation("EmployeeManager")
  tickets       Ticket[]  @relation("TicketRequester")
  assignedTasks Task[]    @relation("TaskAssignedTo")
  createdTasks  Task[]    @relation("TaskAssignedBy")
}

model Department {
  id        String     @id @default(uuid())
  name      String     @unique
  managerId String?
  manager   User?      @relation("DepartmentManager", fields: [managerId], references: [id])
  employees Employee[]
  createdAt DateTime   @default(now())
}

model Employee {
  id            String            @id @default(uuid())
  userId        String            @unique
  employeeCode  String            @unique
  firstName     String
  lastName      String
  phone         String?
  joinDate      DateTime
  status        EmploymentStatus  @default(ACTIVE)
  departmentId  String?
  managerId     String?
  baseSalary    Decimal           @default(0) @db.Decimal(12, 2)
  currency      String            @default("USD")
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  department    Department?       @relation(fields: [departmentId], references: [id])
  manager       User?             @relation("EmployeeManager", fields: [managerId], references: [id])
  attendanceLogs AttendanceLog[]
  leaveRequests LeaveRequest[]
  expenses      Expense[]
  payslips      Payslip[]
  goals         PerformanceGoal[]
  documents     Document[]
}

model AttendanceLog {
  id         String   @id @default(uuid())
  employeeId String
  checkInAt  DateTime
  checkOutAt DateTime?
  source     String   @default("WEB")
  createdAt  DateTime @default(now())
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model LeavePolicy {
  id                String         @id @default(uuid())
  name              String
  annualQuota       Int
  carryForwardLimit Int            @default(0)
  requests          LeaveRequest[]
}

model LeaveRequest {
  id         String      @id @default(uuid())
  employeeId String
  policyId   String
  startDate  DateTime
  endDate    DateTime
  days       Float
  reason     String?
  status     String      @default("PENDING")
  createdAt  DateTime    @default(now())
  employee   Employee    @relation(fields: [employeeId], references: [id])
  policy     LeavePolicy @relation(fields: [policyId], references: [id])
}

model PayrollRun {
  id          String    @id @default(uuid())
  month       Int
  year        Int
  status      String    @default("DRAFT")
  processedAt DateTime?
  payslips    Payslip[]
}

model Payslip {
  id           String     @id @default(uuid())
  payrollRunId String
  employeeId   String
  gross        Decimal    @db.Decimal(12, 2)
  deductions   Decimal    @default(0) @db.Decimal(12, 2)
  net          Decimal    @db.Decimal(12, 2)
  pdfUrl       String?
  payrollRun   PayrollRun @relation(fields: [payrollRunId], references: [id], onDelete: Cascade)
  employee     Employee   @relation(fields: [employeeId], references: [id])
}

model Expense {
  id          String   @id @default(uuid())
  employeeId  String
  category    String
  amount      Decimal  @db.Decimal(12, 2)
  currency    String   @default("USD")
  expenseDate DateTime
  receiptUrl  String?
  status      String   @default("PENDING")
  createdAt   DateTime @default(now())
  employee    Employee @relation(fields: [employeeId], references: [id])
}

model Project {
  id        String   @id @default(uuid())
  name      String
  ownerId   String?
  startDate DateTime?
  endDate   DateTime?
  tasks     Task[]
}

model Task {
  id          String   @id @default(uuid())
  projectId   String?
  assignedTo  String
  assignedBy  String
  title       String
  description String?
  priority    String   @default("MEDIUM")
  status      String   @default("TODO")
  dueDate     DateTime?
  createdAt   DateTime @default(now())
  project     Project? @relation(fields: [projectId], references: [id])
  assignee    User     @relation("TaskAssignedTo", fields: [assignedTo], references: [id])
  creator     User     @relation("TaskAssignedBy", fields: [assignedBy], references: [id])
}

model PerformanceGoal {
  id           String   @id @default(uuid())
  employeeId   String
  title        String
  targetValue  Float?
  currentValue Float    @default(0)
  periodStart  DateTime
  periodEnd    DateTime
  status       String   @default("ON_TRACK")
  employee     Employee @relation(fields: [employeeId], references: [id])
}

model Announcement {
  id        String   @id @default(uuid())
  title     String
  body      String
  audience  String   @default("ALL")
  postedBy  String?
  createdAt DateTime @default(now())
}

model Document {
  id         String    @id @default(uuid())
  employeeId String?
  type       String
  fileUrl    String
  expiresOn  DateTime?
  createdAt  DateTime  @default(now())
  employee   Employee? @relation(fields: [employeeId], references: [id])
}

model Ticket {
  id          String   @id @default(uuid())
  requesterId String
  subject     String
  description String
  priority    String   @default("MEDIUM")
  status      String   @default("OPEN")
  createdAt   DateTime @default(now())
  requester   User     @relation("TicketRequester", fields: [requesterId], references: [id])
}
